# Установка MongoDB 6.0 для кластера на AlmaLinux

Этот скрипт автоматически устанавливает и настраивает MongoDB 6.0 для работы в режиме репликации (Replica Set) на AlmaLinux.

## Что делает скрипт
- Проверяет запуск через sudo
- Добавляет репозиторий MongoDB 6.0
- Обновляет пакеты
- Устанавливает MongoDB
- Настраивает bindIp для доступа по локальному и внешнему IP
- Включает режим репликации (Replica Set) с именем `rs0`
- Открывает порт 27017 в firewall
- Перезапускает и включает MongoDB в автозагрузку
- Показывает статус и версию MongoDB

## Как запустить скрипт

Запустите скрипт с помощью sudo, указав IP-адрес сервера:

```bash
sudo ./setup_on_almalinux.sh <IP-адрес>
```

Пример:
```bash
sudo ./setup_on_almalinux.sh 10.100.10.1
```

## Как создать кластер (Replica Set)

1. Установите MongoDB на всех серверах кластера с помощью этого скрипта, указав соответствующий IP-адрес каждого узла.
2. На одном из узлов выполните инициализацию Replica Set:

Подключитесь к MongoDB Shell:

```bash
mongosh
```

Запустите команду инициализации Replica Set:

```js
rs.initiate({
  _id: "rs0",
  members: [
    { _id: 0, host: "10.100.10.1:27017" },
    { _id: 1, host: "10.100.10.2:27017" },
    { _id: 2, host: "10.100.10.3:27017", "arbiterOnly": true }
  ]
})
```

3. Проверьте статус кластера:

```js
rs.status()
```

**Особенности:**
1. Для обеспечения отказоустойчивости рекомендуется иметь не менее трёх узлов.
2. Вы можете настроить арбитра ("arbiterOnly": true), который не хранит данных, но участвует в выборах нового primary в случае сбоя.
